# para correr esta web app:

# - pip install streamlit
# - streamlit run WM_app.py


import streamlit as st
import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.metrics import mean_squared_error,roc_auc_score,precision_score
from sklearn.metrics import  precision_recall_curve, roc_auc_score, confusion_matrix, accuracy_score, recall_score, precision_score, f1_score,auc, roc_curve
import lightgbm as lgb
from PIL import Image
import requests
import time
import base64

# Header--------------------------------
#st.set_page_config(initial_sidebar_state="expanded")


st.set_page_config(page_title="WM SB Desafio 3",layout="wide",initial_sidebar_state="expanded")

logo = Image.open(requests.get('https://sbghackathon.com/wp-content/uploads/2020/03/sbg.png', stream=True).raw)
st.sidebar.image(logo,width=100)
st.sidebar.title("""Sbghackathon""")

st.sidebar.write('''Equipa : Weka_Masters\n
Elementos:
- João Chamorra
- Tiago Mealha''')

#introdução
st.header(''' Escolha o melhor portefólio de produtos do grupo SuperBock para um determinado cliente (Desafio 3)''')



# Carregar Modelo
col_treino = ['NOVO_ALIMENTAR', 'NOVO_ALOJAMENTO', 'NOVO_CAFETARIA', 'NOVO_CERVEJARIA', 'NOVO_EVENTOS', 'NOVO_FOOD_BAR', 'NOVO_NOITE', 'NOVO_REF_URBANAS', 'NOVO_RESTAURANTE', 'NOVO_SNACK_BAR', 'NOVO_SOCIAL', 'NOVO_SOL', 'NOVO_SPORT_BEER', 'NOVO_UNIVERSITARIO', 'Acores', 'Alentejo', 'Algarve', 'Centro', 'Lisboa e Vale do Tejo', 'Madeira', 'Norte', 'A', 'A+', 'B', 'B+', 'C', 'C+', 'NP', 'P', 'P+', 'Sem Class.', 'Abrantes', 'Abrunheira', 'Abóboda', 'Achada Felpa', 'Achada Grande', 'Achada de António Teixeira', 'Achada do Pau Bastião', 'Achada do Til', 'Aeroporto', 'Aeroporto da Horta', 'Aeroporto de Beja', 'Aeroporto de Faro', 'Agostos', 'Agrelo', 'Agualva-Cacém', 'Aguieira', 'Aguim', 'Alapraia', 'Albergaria-A-Velha', 'Albufeira', 'Alcabideche', 'Alcochete', 'Alcoitão', 'Alcácer do Sal', 'Aldeia Nova', 'Aldeia de Juzo', 'Alenquer', 'Alfena', 'Algueirão', 'Algés', 'Alhandra', 'Almada', 'Almagreira', 'Almancil', 'Almargem do Bispo', 'Almas', 'Almeirim', 'Almoçageme', 'Alpiarça', 'Alporchinhos', 'Alto da Corda', 'Alto do Estanqueiro', 'Alto do Vieiro', 'Alto dos Gaios', 'Alto dos Lombos', 'Altura', 'Alvelos', 'Alverca do Ribatejo', 'Alvito', 'Amadora', 'Amarante', 'Amora', 'Amoreira', 'Anadia', 'Angra do Heroísmo', 'Anico', 'Arada', 'Arco da Calheta', 'Arcos de Valdevez', 'Arcozelo', 'Areal', 'Areal Gordo', 'Areeiro', 'Areia', 'Areia Funda', 'Areia Larga', 'Areias', 'Argivai', 'Armação de Pêra', 'Arneiro', 'Arneiro dos Marinheiros', 'Aroeira', 'Arouca', 'Arrentela', 'Arrifana', 'Arrifes', 'Arroio', 'Arruda dos Vinhos', 'Arão', 'Assafora', 'Atibá', 'Atouguia', 'Avanca', 'Aveiras de Cima', 'Aveiro', 'Aveleira', 'Avintes', 'Avis', 'Azambuja', 'Azaruja', 'Azeitão', 'Azurara', 'Açougue', 'Baguim do Monte', 'Bairro Senhora da Luz', 'Bairro de Santo António', 'Baixa da Banheira', "Banda D' Além", 'Barca', 'Barcarena', 'Barcelos', 'Barqueiros', 'Barrada', 'Barragem Monte da Rocha', 'Barreira', 'Barreiro', 'Barril', 'Batalha', 'Baçal', 'Beja', 'Belas', 'Belmonte de Baixo', 'Bemposta', 'Benavente', 'Benedita', 'Benquerenças', 'Beça', 'Bicesse', 'Birre', 'Boa Morte', 'Bodo', 'Boiças', 'Boição', 'Bom Sucesso', 'Borba', 'Bouro de Santa Maria', 'Braga', 'Bragança', 'Brejos', 'Brejos de Azeitão', 'Buarcos', 'Bucelas', 'Cabeço de Mouro', 'Cabo Branco', 'Cabo de Vialonga', 'Cabouco', 'Cacia', 'Cadafais', 'Cais do Galego', 'Caldas da Rainha', 'Caldas das Taipas', 'Caldas de Monchique', 'Calheta', 'Calço da Chã da Cruz', 'Calço da Cruz', 'Camacha', 'Camarate', 'Caminha', 'Campina de Cima', 'Campinho', 'Campo', 'Campo Maior', 'Campo Raso', 'Campo de Tiro', 'Cancelas da Areia', 'Candelária', 'Canelas', 'Caneças', 'Canhas', 'Caniço', 'Cantanhede', 'Caparide', 'Capelo', 'Carambancha de Cima', 'Carcavelos', 'Carnaxide', 'Carqueijo', 'Carrapateira', 'Carrascal', 'Carrascal de Alvide', 'Carregado', 'Cartaxo', 'Carvalhais', 'Carvalhinho', 'Carvalhos', 'Carvalhosa', 'Casa Branca', 'Casais Próximos', 'Casal', 'Casal da Areia', 'Casal da Barota', 'Casal da Granja', 'Casal de Cambra', 'Casal do Abade', 'Casaldima', 'Cascais', 'Castanheira do Ribatejo', 'Castanheiro do Ouro', 'Castelo', 'Castelo Branco', 'Castelo de Vide', 'Castro Daire', 'Catujal', 'Caxias', 'Caxieira', 'Cedros', 'Celeirós', 'Celorico de Basto', 'Charneca', 'Charneca de Caparica', 'Chaves', 'Chã', 'Chão da Cancela', 'Chão do Cedro Gordo', 'Cidade Sol', 'Cimo de Vila', 'Cobre', 'Cocanha', 'Coimbra', 'Coimbrões', 'Coina', 'Colares', 'Companhia de Baixo', 'Companhia de Cima', 'Conceição da Abóboda', 'Condados', 'Conraria', 'Corredoura', 'Corroios', 'Cortegaça', 'Cortes', 'Costa de Caparica', 'Costa de Lavos', 'Coudelaria', 'Coutada', 'Cova', 'Cova da Iria', 'Covilhã', 'Covinhas', 'Crato', 'Crestuma', 'Criação Velha', 'Cruz Quebrada', 'Cruz de Pau', 'Cuba', 'Cucujães', 'Curral da Pedra', 'Curral das Freiras', 'Custóias', 'Câmara de Lobos', 'Dafundo', 'Deocriste', 'Desconhecido', 'Eco Parque Empresarial de Estarreja', 'Eira Vedra', 'Elvas', 'Embra', 'Entrada da Barca', 'Entroncamento', 'Enxofães', 'Enxurros', 'Ericeira', 'Ermesinde', 'Ermida de Baixo', 'Ervosas', 'Escampadinho', 'Esmoriz', 'Espinho', 'Esposende', 'Estarreja', 'Estoi', 'Estoril', 'Estreito Calheta', 'Estreito Câmara de Lobos', 'Estremoz', 'Fafe', 'Fagilde', 'Fajarda', 'Fajozes', 'Fajã', 'Fajã da Ovelha', 'Fajã de Baixo', 'Fajã dos Vinháticos', 'Famões', 'Faro', 'Farol da Manhenha', 'Feiteiras', 'Felgueiras', 'Ferrarias', 'Fervença', 'Feteira', 'Figueira da Foz', 'Fiães', 'Flamengos', 'Fonte Boa da Brincosa', 'Fontes', 'Fornos de Castel', 'Foros de Amora', 'Foros de Salvaterra', 'Forte da Casa', 'Foz do Arelho', 'Francos', 'Freamunde', 'Frossos', 'Funchal', 'Fundão', 'Furna', 'Fânzeres', 'Fão', 'Gafanha da Nazaré', 'Galiza', 'Gambelas', 'Gandra', 'Ginjas', 'Golegã', 'Gondomar', 'Gorduchas', 'Granel', 'Grijó', 'Grimancelos', 'Grândola', 'Guarda', 'Guia', 'Guilhabreu', 'Guilhufe', 'Guimarães', 'Guincho', 'Gémeos', 'Horta', 'Horta Nova do Mosteiro', 'Idanha', 'Igreja', 'Janes', 'Jardim da Serra', 'Jardim do Mar', 'João Ferino', 'Juncos', 'Jungeiros', 'Junqueira', 'Junqueiro', 'Labruge', 'Lagedo', 'Lagoa', 'Lagos', 'Laje', 'Lajes das Flores', 'Lajes do Pico', 'Lamaceiros', 'Lamego', 'Lameira', 'Lameiros', 'Lanheses', 'Lapas', 'Laveiras', 'Lavra', 'Lavradio', 'Leceia', 'Leiria', 'Leião', 'Leça do Balio', 'Linda a Velha', 'Linda-a-Pastora', 'Linhó', 'Lisboa', 'Livramento', 'Lixa', 'Lombada do Meio', 'Lombinho', 'Lombo do Curral', 'Lombos', 'Lordelo', 'Loulé', 'Loural', 'Loures', 'Lourinhã', 'Lousa', 'Lousada', 'Lousado', 'Lousã', 'Lugar', 'Lugares', 'Luso', 'Luz', 'Maceda', 'Macedo de Cavaleiros', 'Machico', 'Madalena', 'Madalena do Mar', 'Madorna', 'Mafra', 'Maia', 'Maiata de Baixo', 'Maiata de Cima', 'Malaposta', 'Malveira', 'Malveira da Serra', 'Mamodeiro', 'Mangualde', 'Manique', 'Manique de Baixo', 'Manique de Cima', 'Marco de Canaveses', 'Marecos', 'Marinha Grande', 'Marinhais', 'Marmelal', 'Marteleira', 'Marvão', 'Massamá', 'Massapez', 'Mastrontas', 'Matarraque', 'Matioa', 'Matos Cheirinhos', 'Matosinhos', 'Meixomil', 'Mem Martins', 'Mercês', 'Milhundos', 'Minde', 'Mindelo', 'Mira', 'Mira de Aire', 'Miradouro', 'Miraflores', 'Miranda do Douro', 'Mirandela', 'Mirante', 'Mirateca', 'Mitrena', 'Modivas', 'Moita', 'Moita Redonda', 'Molelos', 'Montargil', 'Monte', 'Monte Abraão', 'Monte Cavalo', 'Monte Estoril', 'Monte Gordo', 'Monte Real', 'Monte de Baixo', 'Monte de Caparica', 'Monte de Cima', 'Montelavar', 'Montemor', 'Montemuro', 'Montijo', 'Moreno', 'Morro de Cima', 'Moscavide', 'Mozelos', 'Murches', 'Murtal', 'Murtede', 'Murteiras Redondas', 'Nazaré', 'Neiva', 'Nicho do Rodrigo', 'Norte Pequeno', 'Odivelas', 'Oeiras', "Olhos D'Água", 'Olhão', 'Olivais de Santo António', 'Oliveira', 'Oliveira de Azeméis', 'Oliveira de Frades', 'Oliveira do Bairro', 'Oliveira do Hospital', 'Ourique', 'Ourém', 'Outeiro', 'Outeiro Seco', 'Outeiro de Polima', 'Ovar', 'Pai do Vento', 'Paio Pires', 'Paivas', 'Palmares', 'Palmeira', 'Palmela', 'Paraíso', 'Parchal', 'Parede', 'Paredes', 'Paredes de Coura', 'Passo', 'Paço de Arcos', 'Paços de Ferreira', 'Paúl do Mar', 'Pedra Mole', 'Pedra da Nossa Senhora', 'Pedreiras', 'Pedro Miguel', 'Pedroso', 'Penafiel', 'Penedo', 'Peniche', 'Penteado', 'Perafita', 'Pereira', 'Peso da Régua', 'Picassinos', 'Pico', 'Pico António Fernandes', 'Pico das Pedras', 'Pico do Tanoeiro', 'Piedade', 'Pinhal', 'Pinhal Novo', 'Pinhal da Nazaré', 'Pinhal de Frades', 'Pinhal do Concelho', 'Piodão', 'Poiso', 'Polima', 'Pombal', 'Ponta Delgada', 'Ponta Rasa', 'Ponta do Pargo', 'Ponta do Sol', 'Pontas Negras', 'Ponte Nova', 'Ponte da Barca', 'Ponte da Torre', 'Ponte de Sor', 'Pontinha', 'Portalegre', 'Portela', 'Portela da Azóia', 'Portimão', 'Porto', 'Porto Alto', 'Porto Salvo', 'Porto Santo', 'Praia', 'Praia Verde', 'Praia da Areia Branca', 'Praia da Barra', 'Praia da Vieira', 'Praia da Vitória', 'Praia das Maçãs', 'Praia do Norte de Baixo', 'Praia do Norte de Cima', 'Prazeres', 'Primeira Lombada', 'Prior Velho', 'Póvoa de Lanhoso', 'Póvoa de Santa Iria', 'Póvoa de Santo Adrião', 'Póvoa de Varzim', 'Quarteira', 'Quatrim do Sul', 'Queijas', 'Queluz', 'Queluz de Baixo', 'Quinchães', 'Quinta Grande', 'Quinta da Balaia', 'Quinta da Marquesa IV', 'Quinta da Moura', 'Quinta do Anjo', 'Quinta do Conde', 'Quinta do Lago', 'Ramada', 'Ramalhal', 'Rana', 'Rebelva', 'Rebordosa', 'Redinha', 'Referta', 'Refojos de Basto', 'Regilde', 'Reguengos de Monsaraz', 'Relva', 'Riachos', 'Ribamar', 'Ribeira Brava', 'Ribeira Funda', 'Ribeira Nova', 'Ribeira da Janela', 'Ribeira da Tabua', 'Ribeira do Meio', 'Ribeirinha', 'Ribeiro Frio', 'Ribeirão', 'Rinchoa', 'Rio Maior', 'Rio Meão', 'Rio Tinto', 'Rio de Mouro', 'Roligo', 'Roriz', 'Rosais', 'Sacavém', 'Safões', 'Sagres', 'Salgados', 'Salgueiro', 'Salreu', 'Salão', 'Salão de Cima', 'Samodães', 'Samora Correia', 'Samouco', 'Santa Bárbara', 'Santa Comba Dão', 'Santa Cristina Couto', 'Santa Cruz', 'Santa Cruz da Graciosa', 'Santa Cruz das Flores', 'Santa Cruz do Bispo', 'Santa Iria de Azóia', 'Santa Luzia', 'Santa Maria da Feira', 'Santa Maria de Lamas', 'Santa Marta da Montanha', 'Santa Marta de Corroios', 'Santana', 'Santarém', 'Santiago do Bougado', 'Santiago do Cacém', 'Santo Amaro', 'Santo André', 'Santo Antão do Tojal', 'Santo António', 'Santo António da Serra', 'Santo António dos Cavaleiros', 'Santo Tirso', 'Saramago', 'Sassoeiros', 'Seia', 'Seixal', 'Selmes', 'Semino', 'Senhora da Hora', 'Sequeira', 'Serpa', 'Serra da Silveira', 'Serra de Água', 'Serrado', 'Sesimbra', 'Sete Cidades', 'Setúbal', 'Sever do Vouga', 'Silveira', 'Sines', 'Sintra', 'Sobralinho', 'Soure', 'Souselas', 'Sátão', 'São Brás de Alportel', 'São Caetano', 'São Domingos de Rana', 'São Félix da Marinha', 'São Jacinto', 'São João', 'São João da Madeira', 'São João da Talha', 'São João das Lampas', 'São João do Estoril', 'São Julião do Tojal', 'São Lourenço de Mamporcão', 'São Mamede Coronado', 'São Mamede de Infesta', 'São Marcos', 'São Martinho', 'São Martinho Bougado', 'São Martinho do Campo', 'São Mateus', 'São Pedro', 'São Pedro da Cova', 'São Pedro de Moel', 'São Pedro do Estoril', 'São Pedro do Sul', 'São Romão do Coronado', 'São Roque do Pico', 'São Vicente', 'Talaíde', 'Tamel', 'Tavarede', 'Taveiro', 'Tavira', 'Teixoso', 'Telheiro', 'Telões', 'Tercena', 'Termas', 'Terra Alta', 'Terra do Batista', 'Terra do Pão', 'Terras', 'Terreiro', 'Terrugem', 'Terços', 'Tires', 'Toledos', 'Tomar', 'Tondela', 'Tornada', 'Torre', 'Torre da Marinha', 'Torre de Coelheiros', 'Torreira', 'Torres Novas', 'Torres Vedras', 'Trafaria', 'Trajouce', 'Travasso', 'Traço de Gravatos', 'Tróia', 'Turquel', 'Tábua', 'Urbanização Solférias', 'Urrô', 'Vagos', 'Valbom', 'Vale Centianes', 'Vale da Pedra', 'Vale da Telha', 'Vale de Cambra', 'Vale de Currais', 'Vale de Figueira', 'Vale de Janelas', 'Vale de Lobo', 'Vale de São Cosme', 'Valejas', 'Valença', 'Valongo', 'Valpaços', 'Valverde', 'Varais', 'Varche', 'Vargem', 'Velas', 'Venda Nova', 'Venda do Pinheiro', 'Vendas', 'Vendas Novas', 'Vialonga', 'Viana do Castelo', 'Vieira de Leiria', 'Vila', 'Vila Chã de Ourique', 'Vila Cortês do Mondego', 'Vila Franca de Xira', 'Vila Frescainha', 'Vila Fria', 'Vila Meã', 'Vila Nogueira de Azeitão', 'Vila Nova da Rainha', 'Vila Nova de Cerveira', 'Vila Nova de Famalicão', 'Vila Nova de Gaia', 'Vila Nova de Milfontes', 'Vila Nova de Santo André', 'Vila Porto Moniz', 'Vila Pouca da Beira', 'Vila Praia de Âncora', 'Vila Real', 'Vila Real de Santo António', 'Vila Ruiva', 'Vila Verde', 'Vila Viçosa', 'Vila de Frades', 'Vila de Rei', 'Vila de São Vicente', 'Vila do Conde', 'Vila do Porto', 'Vilamoura', 'Vilarelho', 'Viseu', 'Vista Alegre', 'Vizela', 'Várzea', 'Várzea de Sintra', 'Zambujal', 'Zambujeiro', 'Zibreira', 'Zona Industrial de Albergaria-A-Velha', 'Zona Industrial de Mortágua', 'Zona Industrial do Canedo', 'Água de Pena', 'Águas Pousadas', 'Águeda', 'Évora', 'Ílhavo', 'Óbidos']
target = ['Barril TP(10 L)', 'Barril TP(20 L)', 'Barril TP(30 L)', 'Barril TP(5 L)', 'Barril TR(20 L)', 'Barril TR(30 L)', 'Barril TR(50 L)', 'Beer Drive(1000 L)', 'Beer Drive(250 L)', 'Beer Drive(500 L)', 'Garrafa Alumínio TP(0.33 L)', 'Garrafa PET(0.25 L)', 'Garrafa PET(0.33 L)', 'Garrafa PET(0.50 L)', 'Garrafa PET(0.75 L)', 'Garrafa PET(1 L)', 'Garrafa PET(1.5 L)', 'Garrafa PET(5 L)', 'Garrafa PET(6 L)', 'Garrafa vidro TP(0.20 L)', 'Garrafa vidro TP(0.25 L)', 'Garrafa vidro TP(0.33 L)', 'Garrafa vidro TP(0.355 L)', 'Garrafa vidro TP(0.375 L)', 'Garrafa vidro TP(0.50 L)', 'Garrafa vidro TP(0.75 L)', 'Garrafa vidro TP(1 L)', 'Garrafa vidro TP(3 L)', 'Garrafa vidro TR(0.20 L)', 'Garrafa vidro TR(0.25 L)', 'Garrafa vidro TR(0.33 L)', 'Garrafa vidro TR(0.375 L)', 'Garrafa vidro TR(0.50 L)', 'Garrafa vidro TR(0.75 L)', 'Garrafa vidro TR(1 L)', 'Lata(0.33 L)', 'Lata(0.50 L)', 'Marca : APS', 'Marca : Brisa', 'Marca : Brooklyn', 'Marca : Browers', 'Marca : Campo da Vinha', 'Marca : Caramulo', 'Marca : Carlsberg', 'Marca : Cheers', 'Marca : Cristal', 'Marca : Frisumo', 'Marca : Frutea', 'Marca : Frutis', 'Marca : Frutis Natura', 'Marca : Grimbergen', 'Marca : Guaraná Brasil', 'Marca : Guinness', 'Marca : Lusitana', 'Marca : Melgaço', 'Marca : Monte Sacro', 'Marca : Pedras', 'Marca : Planura', 'Marca : Porta Nova', 'Marca : Quinta do Minho', 'Marca : Republica Cerveja', 'Marca : Rical', 'Marca : Snappy', 'Marca : Somersby', 'Marca : Super Bock', 'Marca : Vidago', 'Marca : Vinha das Garças', 'Marca : Vinha de Mazouco', 'Marca : Vini', 'Marca : Vitalis', 'Sabor : Amber Lager', 'Sabor : Ananás', 'Sabor : Bavaria Weiss', 'Sabor : Bengal Amber IPA', 'Sabor : Blackberry', 'Sabor : Christmas Brew', 'Sabor : Citrus', 'Sabor : Cola', 'Sabor : Colheita', 'Sabor : Czech Golden Lager', 'Sabor : DOUBLE', 'Sabor : Framboesa', 'Sabor : Frutos Vermelhos', 'Sabor : Ginger Ale', 'Sabor : Hoppy Lager', 'Sabor : IPA', 'Sabor : Japan Rice Lager', 'Sabor : LAGER', 'Sabor : Laranja', 'Sabor : Laranja/Maracujá', 'Sabor : Lima-Limão', 'Sabor : Lima/Hortelã', 'Sabor : Limão', 'Sabor : Limão & Magnésio', 'Sabor : Manga/Laranja', 'Sabor : Manga/Maracujá', 'Sabor : Maracujá', 'Sabor : Maçã', 'Sabor : Melancia', 'Sabor : MultiPack', 'Sabor : Munich Dunkel', 'Sabor : Naranjito', 'Sabor : Oktober Fest', 'Sabor : PT Blonde Ale', 'Sabor : Pêssego', 'Sabor : Reserva', 'Sabor : Ribatejo', 'Sabor : Saison', 'Sabor : Sem Sabor', 'Sabor : Summer Ale', 'Sabor : Syrah', 'Sabor : Tangerina', 'Sabor : Terras do Sado', 'Sabor : Thames Porter', 'Sabor : Vinho Verde', 'Sabor : Wild Lemon', 'Sabor : Água Tónica', 'SubMarca : APS', 'SubMarca : Brisa', 'SubMarca : Brooklyn', 'SubMarca : Browers', 'SubMarca : CORUJA', 'SubMarca : Campo da Vinha', 'SubMarca : Caramulo', 'SubMarca : Carlsberg', 'SubMarca : Cheers Branca', 'SubMarca : Cheers Preta', 'SubMarca : Cheers Radler', 'SubMarca : Cristal Branca', 'SubMarca : Cristal Preta', 'SubMarca : FN Light´s', 'SubMarca : Frisumo', 'SubMarca : Frutea', 'SubMarca : Frutis', 'SubMarca : Grimbergen', 'SubMarca : Guaraná Brasil', 'SubMarca : Guinness', 'SubMarca : Lusitana', 'SubMarca : Melgaço', 'SubMarca : Monte Sacro', 'SubMarca : Multipack', 'SubMarca : Pedras Levíssima', 'SubMarca : Pedras Sabores', 'SubMarca : Pedras Salgadas', 'SubMarca : Planura', 'SubMarca : Porta Nova', 'SubMarca : Quinta do Minho', 'SubMarca : Rep Cerveja Puro Malte', 'SubMarca : Rep Cerveja Weiss', 'SubMarca : Rep Cerveja Whisky', 'SubMarca : Rical', 'SubMarca : SB Abadia', 'SubMarca : SB Classic', 'SubMarca : SB Edição Limitada', 'SubMarca : SB Festa', 'SubMarca : SB Green', 'SubMarca : SB Original', 'SubMarca : SB Selecção 1927', 'SubMarca : SB Sem Glúten', 'SubMarca : SB Stout', 'SubMarca : SB sem Álcool', 'SubMarca : SB sem Álcool 0.0%', 'SubMarca : SB sem Álcool Preta', 'SubMarca : Snappy Cola', 'SubMarca : Snappy Ginger Ale', 'SubMarca : Snappy Lima-Limão', 'SubMarca : Snappy Água Tónica', 'SubMarca : Somersby', 'SubMarca : Vidago', 'SubMarca : Vinha das Garças', 'SubMarca : Vinha de Mazouco', 'SubMarca : Vini Branco', 'SubMarca : Vini Sangria', 'SubMarca : Vitalis', 'SubMarca : Vitalis +', 'SubMarca : Vitalis Sabores', 'UMBase: BAR', 'UMBase: C12', 'UMBase: C6', 'UMBase: CXA', 'UMBase: GFO', 'UMBase: GRA', 'UMBase: L', 'UMBase: PAC', 'UMBase: TAB']
localidades = ['Abrantes', 'Abrunheira', 'Abóboda', 'Achada Felpa', 'Achada Grande', 'Achada de António Teixeira', 'Achada do Pau Bastião', 'Achada do Til', 'Aeroporto', 'Aeroporto da Horta', 'Aeroporto de Beja', 'Aeroporto de Faro', 'Agostos', 'Agrelo', 'Agualva-Cacém', 'Aguieira', 'Aguim', 'Alapraia', 'Albergaria-A-Velha', 'Albufeira', 'Alcabideche', 'Alcochete', 'Alcoitão', 'Alcácer do Sal', 'Aldeia Nova', 'Aldeia de Juzo', 'Alenquer', 'Alfena', 'Algueirão', 'Algés', 'Alhandra', 'Almada', 'Almagreira', 'Almancil', 'Almargem do Bispo', 'Almas', 'Almeirim', 'Almoçageme', 'Alpiarça', 'Alporchinhos', 'Alto da Corda', 'Alto do Estanqueiro', 'Alto do Vieiro', 'Alto dos Gaios', 'Alto dos Lombos', 'Altura', 'Alvelos', 'Alverca do Ribatejo', 'Alvito', 'Amadora', 'Amarante', 'Amora', 'Amoreira', 'Anadia', 'Angra do Heroísmo', 'Anico', 'Arada', 'Arco da Calheta', 'Arcos de Valdevez', 'Arcozelo', 'Areal', 'Areal Gordo', 'Areeiro', 'Areia', 'Areia Funda', 'Areia Larga', 'Areias', 'Argivai', 'Armação de Pêra', 'Arneiro', 'Arneiro dos Marinheiros', 'Aroeira', 'Arouca', 'Arrentela', 'Arrifana', 'Arrifes', 'Arroio', 'Arruda dos Vinhos', 'Arão', 'Assafora', 'Atibá', 'Atouguia', 'Avanca', 'Aveiras de Cima', 'Aveiro', 'Aveleira', 'Avintes', 'Avis', 'Azambuja', 'Azaruja', 'Azeitão', 'Azurara', 'Açougue', 'Baguim do Monte', 'Bairro Senhora da Luz', 'Bairro de Santo António', 'Baixa da Banheira', "Banda D' Além", 'Barca', 'Barcarena', 'Barcelos', 'Barqueiros', 'Barrada', 'Barragem Monte da Rocha', 'Barreira', 'Barreiro', 'Barril', 'Batalha', 'Baçal', 'Beja', 'Belas', 'Belmonte de Baixo', 'Bemposta', 'Benavente', 'Benedita', 'Benquerenças', 'Beça', 'Bicesse', 'Birre', 'Boa Morte', 'Bodo', 'Boiças', 'Boição', 'Bom Sucesso', 'Borba', 'Bouro de Santa Maria', 'Braga', 'Bragança', 'Brejos', 'Brejos de Azeitão', 'Buarcos', 'Bucelas', 'Cabeço de Mouro', 'Cabo Branco', 'Cabo de Vialonga', 'Cabouco', 'Cacia', 'Cadafais', 'Cais do Galego', 'Caldas da Rainha', 'Caldas das Taipas', 'Caldas de Monchique', 'Calheta', 'Calço da Chã da Cruz', 'Calço da Cruz', 'Camacha', 'Camarate', 'Caminha', 'Campina de Cima', 'Campinho', 'Campo', 'Campo Maior', 'Campo Raso', 'Campo de Tiro', 'Cancelas da Areia', 'Candelária', 'Canelas', 'Caneças', 'Canhas', 'Caniço', 'Cantanhede', 'Caparide', 'Capelo', 'Carambancha de Cima', 'Carcavelos', 'Carnaxide', 'Carqueijo', 'Carrapateira', 'Carrascal', 'Carrascal de Alvide', 'Carregado', 'Cartaxo', 'Carvalhais', 'Carvalhinho', 'Carvalhos', 'Carvalhosa', 'Casa Branca', 'Casais Próximos', 'Casal', 'Casal da Areia', 'Casal da Barota', 'Casal da Granja', 'Casal de Cambra', 'Casal do Abade', 'Casaldima', 'Cascais', 'Castanheira do Ribatejo', 'Castanheiro do Ouro', 'Castelo', 'Castelo Branco', 'Castelo de Vide', 'Castro Daire', 'Catujal', 'Caxias', 'Caxieira', 'Cedros', 'Celeirós', 'Celorico de Basto', 'Charneca', 'Charneca de Caparica', 'Chaves', 'Chã', 'Chão da Cancela', 'Chão do Cedro Gordo', 'Cidade Sol', 'Cimo de Vila', 'Cobre', 'Cocanha', 'Coimbra', 'Coimbrões', 'Coina', 'Colares', 'Companhia de Baixo', 'Companhia de Cima', 'Conceição da Abóboda', 'Condados', 'Conraria', 'Corredoura', 'Corroios', 'Cortegaça', 'Cortes', 'Costa de Caparica', 'Costa de Lavos', 'Coudelaria', 'Coutada', 'Cova', 'Cova da Iria', 'Covilhã', 'Covinhas', 'Crato', 'Crestuma', 'Criação Velha', 'Cruz Quebrada', 'Cruz de Pau', 'Cuba', 'Cucujães', 'Curral da Pedra', 'Curral das Freiras', 'Custóias', 'Câmara de Lobos', 'Dafundo', 'Deocriste', 'Desconhecido', 'Eco Parque Empresarial de Estarreja', 'Eira Vedra', 'Elvas', 'Embra', 'Entrada da Barca', 'Entroncamento', 'Enxofães', 'Enxurros', 'Ericeira', 'Ermesinde', 'Ermida de Baixo', 'Ervosas', 'Escampadinho', 'Esmoriz', 'Espinho', 'Esposende', 'Estarreja', 'Estoi', 'Estoril', 'Estreito Calheta', 'Estreito Câmara de Lobos', 'Estremoz', 'Fafe', 'Fagilde', 'Fajarda', 'Fajozes', 'Fajã', 'Fajã da Ovelha', 'Fajã de Baixo', 'Fajã dos Vinháticos', 'Famões', 'Faro', 'Farol da Manhenha', 'Feiteiras', 'Felgueiras', 'Ferrarias', 'Fervença', 'Feteira', 'Figueira da Foz', 'Fiães', 'Flamengos', 'Fonte Boa da Brincosa', 'Fontes', 'Fornos de Castel', 'Foros de Amora', 'Foros de Salvaterra', 'Forte da Casa', 'Foz do Arelho', 'Francos', 'Freamunde', 'Frossos', 'Funchal', 'Fundão', 'Furna', 'Fânzeres', 'Fão', 'Gafanha da Nazaré', 'Galiza', 'Gambelas', 'Gandra', 'Ginjas', 'Golegã', 'Gondomar', 'Gorduchas', 'Granel', 'Grijó', 'Grimancelos', 'Grândola', 'Guarda', 'Guia', 'Guilhabreu', 'Guilhufe', 'Guimarães', 'Guincho', 'Gémeos', 'Horta', 'Horta Nova do Mosteiro', 'Idanha', 'Igreja', 'Janes', 'Jardim da Serra', 'Jardim do Mar', 'João Ferino', 'Juncos', 'Jungeiros', 'Junqueira', 'Junqueiro', 'Labruge', 'Lagedo', 'Lagoa', 'Lagos', 'Laje', 'Lajes das Flores', 'Lajes do Pico', 'Lamaceiros', 'Lamego', 'Lameira', 'Lameiros', 'Lanheses', 'Lapas', 'Laveiras', 'Lavra', 'Lavradio', 'Leceia', 'Leiria', 'Leião', 'Leça do Balio', 'Linda a Velha', 'Linda-a-Pastora', 'Linhó', 'Lisboa', 'Livramento', 'Lixa', 'Lombada do Meio', 'Lombinho', 'Lombo do Curral', 'Lombos', 'Lordelo', 'Loulé', 'Loural', 'Loures', 'Lourinhã', 'Lousa', 'Lousada', 'Lousado', 'Lousã', 'Lugar', 'Lugares', 'Luso', 'Luz', 'Maceda', 'Macedo de Cavaleiros', 'Machico', 'Madalena', 'Madalena do Mar', 'Madorna', 'Mafra', 'Maia', 'Maiata de Baixo', 'Maiata de Cima', 'Malaposta', 'Malveira', 'Malveira da Serra', 'Mamodeiro', 'Mangualde', 'Manique', 'Manique de Baixo', 'Manique de Cima', 'Marco de Canaveses', 'Marecos', 'Marinha Grande', 'Marinhais', 'Marmelal', 'Marteleira', 'Marvão', 'Massamá', 'Massapez', 'Mastrontas', 'Matarraque', 'Matioa', 'Matos Cheirinhos', 'Matosinhos', 'Meixomil', 'Mem Martins', 'Mercês', 'Milhundos', 'Minde', 'Mindelo', 'Mira', 'Mira de Aire', 'Miradouro', 'Miraflores', 'Miranda do Douro', 'Mirandela', 'Mirante', 'Mirateca', 'Mitrena', 'Modivas', 'Moita', 'Moita Redonda', 'Molelos', 'Montargil', 'Monte', 'Monte Abraão', 'Monte Cavalo', 'Monte Estoril', 'Monte Gordo', 'Monte Real', 'Monte de Baixo', 'Monte de Caparica', 'Monte de Cima', 'Montelavar', 'Montemor', 'Montemuro', 'Montijo', 'Moreno', 'Morro de Cima', 'Moscavide', 'Mozelos', 'Murches', 'Murtal', 'Murtede', 'Murteiras Redondas', 'Nazaré', 'Neiva', 'Nicho do Rodrigo', 'Norte Pequeno', 'Odivelas', 'Oeiras', "Olhos D'Água", 'Olhão', 'Olivais de Santo António', 'Oliveira', 'Oliveira de Azeméis', 'Oliveira de Frades', 'Oliveira do Bairro', 'Oliveira do Hospital', 'Ourique', 'Ourém', 'Outeiro', 'Outeiro Seco', 'Outeiro de Polima', 'Ovar', 'Pai do Vento', 'Paio Pires', 'Paivas', 'Palmares', 'Palmeira', 'Palmela', 'Paraíso', 'Parchal', 'Parede', 'Paredes', 'Paredes de Coura', 'Passo', 'Paço de Arcos', 'Paços de Ferreira', 'Paúl do Mar', 'Pedra Mole', 'Pedra da Nossa Senhora', 'Pedreiras', 'Pedro Miguel', 'Pedroso', 'Penafiel', 'Penedo', 'Peniche', 'Penteado', 'Perafita', 'Pereira', 'Peso da Régua', 'Picassinos', 'Pico', 'Pico António Fernandes', 'Pico das Pedras', 'Pico do Tanoeiro', 'Piedade', 'Pinhal', 'Pinhal Novo', 'Pinhal da Nazaré', 'Pinhal de Frades', 'Pinhal do Concelho', 'Piodão', 'Poiso', 'Polima', 'Pombal', 'Ponta Delgada', 'Ponta Rasa', 'Ponta do Pargo', 'Ponta do Sol', 'Pontas Negras', 'Ponte Nova', 'Ponte da Barca', 'Ponte da Torre', 'Ponte de Sor', 'Pontinha', 'Portalegre', 'Portela', 'Portela da Azóia', 'Portimão', 'Porto', 'Porto Alto', 'Porto Salvo', 'Porto Santo', 'Praia', 'Praia Verde', 'Praia da Areia Branca', 'Praia da Barra', 'Praia da Vieira', 'Praia da Vitória', 'Praia das Maçãs', 'Praia do Norte de Baixo', 'Praia do Norte de Cima', 'Prazeres', 'Primeira Lombada', 'Prior Velho', 'Póvoa de Lanhoso', 'Póvoa de Santa Iria', 'Póvoa de Santo Adrião', 'Póvoa de Varzim', 'Quarteira', 'Quatrim do Sul', 'Queijas', 'Queluz', 'Queluz de Baixo', 'Quinchães', 'Quinta Grande', 'Quinta da Balaia', 'Quinta da Marquesa IV', 'Quinta da Moura', 'Quinta do Anjo', 'Quinta do Conde', 'Quinta do Lago', 'Ramada', 'Ramalhal', 'Rana', 'Rebelva', 'Rebordosa', 'Redinha', 'Referta', 'Refojos de Basto', 'Regilde', 'Reguengos de Monsaraz', 'Relva', 'Riachos', 'Ribamar', 'Ribeira Brava', 'Ribeira Funda', 'Ribeira Nova', 'Ribeira da Janela', 'Ribeira da Tabua', 'Ribeira do Meio', 'Ribeirinha', 'Ribeiro Frio', 'Ribeirão', 'Rinchoa', 'Rio Maior', 'Rio Meão', 'Rio Tinto', 'Rio de Mouro', 'Roligo', 'Roriz', 'Rosais', 'Sacavém', 'Safões', 'Sagres', 'Salgados', 'Salgueiro', 'Salreu', 'Salão', 'Salão de Cima', 'Samodães', 'Samora Correia', 'Samouco', 'Santa Bárbara', 'Santa Comba Dão', 'Santa Cristina Couto', 'Santa Cruz', 'Santa Cruz da Graciosa', 'Santa Cruz das Flores', 'Santa Cruz do Bispo', 'Santa Iria de Azóia', 'Santa Luzia', 'Santa Maria da Feira', 'Santa Maria de Lamas', 'Santa Marta da Montanha', 'Santa Marta de Corroios', 'Santana', 'Santarém', 'Santiago do Bougado', 'Santiago do Cacém', 'Santo Amaro', 'Santo André', 'Santo Antão do Tojal', 'Santo António', 'Santo António da Serra', 'Santo António dos Cavaleiros', 'Santo Tirso', 'Saramago', 'Sassoeiros', 'Seia', 'Seixal', 'Selmes', 'Semino', 'Senhora da Hora', 'Sequeira', 'Serpa', 'Serra da Silveira', 'Serra de Água', 'Serrado', 'Sesimbra', 'Sete Cidades', 'Setúbal', 'Sever do Vouga', 'Silveira', 'Sines', 'Sintra', 'Sobralinho', 'Soure', 'Souselas', 'Sátão', 'São Brás de Alportel', 'São Caetano', 'São Domingos de Rana', 'São Félix da Marinha', 'São Jacinto', 'São João', 'São João da Madeira', 'São João da Talha', 'São João das Lampas', 'São João do Estoril', 'São Julião do Tojal', 'São Lourenço de Mamporcão', 'São Mamede Coronado', 'São Mamede de Infesta', 'São Marcos', 'São Martinho', 'São Martinho Bougado', 'São Martinho do Campo', 'São Mateus', 'São Pedro', 'São Pedro da Cova', 'São Pedro de Moel', 'São Pedro do Estoril', 'São Pedro do Sul', 'São Romão do Coronado', 'São Roque do Pico', 'São Vicente', 'Talaíde', 'Tamel', 'Tavarede', 'Taveiro', 'Tavira', 'Teixoso', 'Telheiro', 'Telões', 'Tercena', 'Termas', 'Terra Alta', 'Terra do Batista', 'Terra do Pão', 'Terras', 'Terreiro', 'Terrugem', 'Terços', 'Tires', 'Toledos', 'Tomar', 'Tondela', 'Tornada', 'Torre', 'Torre da Marinha', 'Torre de Coelheiros', 'Torreira', 'Torres Novas', 'Torres Vedras', 'Trafaria', 'Trajouce', 'Travasso', 'Traço de Gravatos', 'Tróia', 'Turquel', 'Tábua', 'Urbanização Solférias', 'Urrô', 'Vagos', 'Valbom', 'Vale Centianes', 'Vale da Pedra', 'Vale da Telha', 'Vale de Cambra', 'Vale de Currais', 'Vale de Figueira', 'Vale de Janelas', 'Vale de Lobo', 'Vale de São Cosme', 'Valejas', 'Valença', 'Valongo', 'Valpaços', 'Valverde', 'Varais', 'Varche', 'Vargem', 'Velas', 'Venda Nova', 'Venda do Pinheiro', 'Vendas', 'Vendas Novas', 'Vialonga', 'Viana do Castelo', 'Vieira de Leiria', 'Vila', 'Vila Chã de Ourique', 'Vila Cortês do Mondego', 'Vila Franca de Xira', 'Vila Frescainha', 'Vila Fria', 'Vila Meã', 'Vila Nogueira de Azeitão', 'Vila Nova da Rainha', 'Vila Nova de Cerveira', 'Vila Nova de Famalicão', 'Vila Nova de Gaia', 'Vila Nova de Milfontes', 'Vila Nova de Santo André', 'Vila Porto Moniz', 'Vila Pouca da Beira', 'Vila Praia de Âncora', 'Vila Real', 'Vila Real de Santo António', 'Vila Ruiva', 'Vila Verde', 'Vila Viçosa', 'Vila de Frades', 'Vila de Rei', 'Vila de São Vicente', 'Vila do Conde', 'Vila do Porto', 'Vilamoura', 'Vilarelho', 'Viseu', 'Vista Alegre', 'Vizela', 'Várzea', 'Várzea de Sintra', 'Zambujal', 'Zambujeiro', 'Zibreira', 'Zona Industrial de Albergaria-A-Velha', 'Zona Industrial de Mortágua', 'Zona Industrial do Canedo', 'Água de Pena', 'Águas Pousadas', 'Águeda', 'Évora', 'Ílhavo', 'Óbidos']
regiao = ['Acores', 'Alentejo', 'Algarve', 'Centro', 'Lisboa e Vale do Tejo', 'Madeira', 'Norte']
seg =['NOVO_ALIMENTAR', 'NOVO_ALOJAMENTO', 'NOVO_CAFETARIA','NOVO_CERVEJARIA', 'NOVO_EVENTOS', 'NOVO_FOOD_BAR', 'NOVO_NOITE','NOVO_REF_URBANAS', 'NOVO_RESTAURANTE', 'NOVO_SNACK_BAR', 'NOVO_SOCIAL','NOVO_SOL', 'NOVO_SPORT_BEER', 'NOVO_UNIVERSITARIO']
pot = ['A', 'A+', 'B', 'B+', 'C', 'C+', 'NP', 'P', 'P+', 'Sem Class.']

#adiconar ao layout as opções
val_pot = st.selectbox("Potencial", list(range(len(pot))), format_func=lambda x: pot[x])
val_reg = st.selectbox("Região", list(range(len(regiao))), format_func=lambda x: regiao[x])
val_local = st.selectbox("Localidade", list(range(len(localidades))), format_func=lambda x: localidades[x])
val_seg = st.selectbox("Segmentação", list(range(len(seg))), format_func=lambda x: seg[x])

thes = st.slider("Classification Probability Threshold",0.0,1.0,0.7,0.1)

if st.button('Inferir'):
	caminho = 'https://1drv.ms/u/s!AuZdJq9kiHjEts1_LPxRATWqzFvYcA?e=hmZjlg'
	data_bytes64 = base64.b64encode(bytes(caminho, 'utf-8'))
	data_bytes64_String = data_bytes64.decode('utf-8').replace('/','_').replace('+','-').rstrip("=")
	resultUrl = f"https://api.onedrive.com/v1.0/shares/u!{data_bytes64_String}/root/content"
	#st.write(resultUrl)
	#df_load_modelo = pd.read_csv('modelo.csv')
	df_load_modelo = pd.read_csv(resultUrl)

	sucesso = st.success('Modelo carregado!')
	time.sleep(2)
	sucesso.empty()

	#inferir
	lista_clf = {}
	for x,y in zip(df_load_modelo.target, df_load_modelo.modelo):
		lista_clf[x] = lgb.Booster(model_str=y)

	product = []
	y_prob = []
	inferir = {}

	for i in range(0,len(col_treino)):
	    inferir[col_treino[i]]=0

	inferir[localidades[val_local]] = 1
	inferir[regiao[val_reg]] = 1
	inferir[seg[val_seg]] = 1
	inferir[pot[val_pot]] =1

	for i in df_load_modelo.target:
	    y_pred_prob =lista_clf[i].predict(pd.DataFrame.from_dict({"inferir":inferir.values()}).T)
	    y_pred = np.where(y_pred_prob > thes, 1, 0)
	    if y_pred>0:
	        product.append(i)
	        y_prob.append(float(y_pred_prob))


	resultado = pd.DataFrame.from_dict({"Produto":product, 'Probabilidade': y_prob })

	col1, col2 = st.beta_columns(2)
	with col1:
		st.header("Tabela")
		st.write(resultado)

	with col2:
		st.header("Gráfico")
		#chart_data = resultado
		#st.ch(chart_data)
		#
		st.pyplot(resultado.plot.bar(x='Produto',y='Probabilidade',figsize=(5,3)).get_figure(),use_column_width=True)
